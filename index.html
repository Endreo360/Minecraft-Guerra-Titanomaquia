<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Minecraft Guerra: A Titanomaquia</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Metamorphous&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        obsidian: '#1a1a1a', bedrock: '#0a0a0a', gold: '#FFD700', golddim: '#B8860B',
                        mythicred: '#8B0000', mythicblue: '#191970', diamond: '#b9f2ff', emerald: '#50c878', chocolate: '#D2691E'
                    },
                    fontFamily: { heading: ['Cinzel', 'serif'], subheading: ['Metamorphous', 'serif'], body: ['Open Sans', 'sans-serif'] },
                    backgroundImage: { 'Greek-pattern': "url('https://www.transparenttextures.com/patterns/black-scales.png')" },
                    animation: { 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'float': 'float 3s ease-in-out infinite', 'glow': 'glow 2s ease-in-out infinite alternate', 'shine': 'shine 1s linear infinite', 'float-up': 'floatUp 15s linear forwards' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        glow: { 'from': { textShadow: '0 0 10px #FFD700, 0 0 20px #B8860B' }, 'to': { textShadow: '0 0 20px #FFD700, 0 0 30px #FFD700, 0 0 40px #B8860B' } },
                        floatUp: { '0%': { bottom: '-10%', opacity: '0', transform: 'scale(0.5)' }, '10%': { opacity: '0.6' }, '90%': { opacity: '0.6' }, '100%': { bottom: '110%', opacity: '0', transform: 'scale(1)' } }
                    }
                }
            }
        }
    </script>
    
    <style>
        ::-webkit-scrollbar { width: 10px; } ::-webkit-scrollbar-track { background: #0a0a0a; } ::-webkit-scrollbar-thumb { background: #B8860B; border-radius: 5px; }
        .gold-glow-text { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        .input-mythic { background-color: rgba(0, 0, 0, 0.4); border: 1px solid #444; color: #e5e7eb; padding: 0.75rem; width: 100%; border-radius: 0.375rem; transition: all 0.3s; font-family: 'Open Sans', sans-serif; }
        .input-mythic:focus { border-color: #FFD700; outline: none; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        .glass-picker-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 8px; }
        .glass-option { aspect-ratio: 1; cursor: pointer; border: 2px solid rgba(255, 255, 255, 0.1); position: relative; transition: transform 0.1s, border-color 0.1s; background-image: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 20%, rgba(255,255,255,0) 80%, rgba(255,255,255,0.1) 100%); }
        .glass-option:hover { transform: scale(1.1); z-index: 10; border-color: rgba(255, 255, 255, 0.5); }
        .glass-option.selected { border: 3px solid #FFD700; box-shadow: 0 0 10px #FFD700; transform: scale(1.1); z-index: 10; }
        .glass-option.disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(100%); transform: none; border-color: #444; }
        .pantheom-card { transition: all 0.4s ease; }
        .pantheom-card:hover { transform: translateY(-10px) scale(1.02); }
        .leader-img-container { mask-image: linear-gradient(to bottom, black 80%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%); }
        #floating-names-container { position: absolute; inset: 0; pointer-events: none; z-index: 5; overflow: hidden; }
        .floating-name { position: absolute; color: rgba(255, 215, 0, 0.3); font-family: 'Cinzel', serif; font-weight: bold; text-transform: uppercase; text-shadow: 0 0 5px rgba(0,0,0,0.8); white-space: nowrap; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 15px rgba(184, 134, 11, 0.3); }
        .farm-taken { opacity: 0.5; cursor: not-allowed !important; filter: grayscale(80%); }
    </style>
</head>
<body class="bg-bedrock text-gray-200 font-body overflow-x-hidden selection:bg-gold selection:text-black">

    <nav class="fixed top-0 w-full z-40 bg-obsidian/90 backdrop-blur-md border-b border-golddim/30">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2"><span class="material-symbols-outlined text-gold">swords</span><span class="font-heading font-bold text-xl text-gold gold-glow-text">A Batalha dos 100</span></div>
            <div class="hidden md:flex gap-6 text-sm font-semibold tracking-widest text-gray-400">
                <a href="#introducao" class="hover:text-gold transition-colors">GUIA</a>
                <a href="#ciclo" class="hover:text-gold transition-colors">HOR√ÅRIOS</a>
                <a href="#pantheom" class="hover:text-gold transition-colors text-gold">L√çDERES</a>
                <a href="#clas" class="hover:text-gold transition-colors">CL√ÉS</a>
                <a href="#economia" class="hover:text-gold transition-colors">ECONOMIA</a>
                <a href="#registro" class="hover:text-gold transition-colors">REGISTRO</a>
                <a href="#saga" class="hover:text-gold transition-colors">SAGA</a>
                <a href="#tesouro" class="text-gold hover:text-white transition-colors border border-gold/30 px-2 py-1 rounded bg-gold/10">TESOURO</a>
            </div>
        </div>
    </nav>

    <header class="relative h-screen flex items-center justify-center overflow-hidden bg-obsidian">
        <div id="floating-names-container"></div>
        <div class="absolute inset-0 z-0"><img src="img/atenas.jpg" alt="Background" class="w-full h-full object-cover opacity-50 grayscale brightness-75"><div class="absolute inset-0 bg-gradient-to-b from-transparent via-bedrock/60 to-bedrock"></div></div>
        
        <div class="relative z-10 text-center px-4 max-w-4xl fade-in-section">
            <div class="mb-4 inline-block px-4 py-1 border border-gold/50 rounded-full bg-black/50 backdrop-blur-sm"><span class="text-gold text-xs font-bold tracking-[0.3em] uppercase">Saga: A Titanomaquia</span></div>
            <h1 class="text-5xl md:text-7xl font-heading font-black text-white mb-6 leading-tight drop-shadow-2xl">MINECRAFT <span class="text-transparent bg-clip-text bg-gradient-to-r from-gold to-yellow-200">GUERRA</span></h1>
            <p class="text-lg md:text-2xl font-subheading text-gray-300 italic mb-8 max-w-2xl mx-auto border-l-4 border-gold pl-6 text-left">"Tebas olha para baixo, entediado com a paz. Ele exige gl√≥ria. Ele exige sangue. Ele exige um Campe√£o."</p>

            <div class="mb-12 flex flex-col items-center gap-8">
                <div class="text-center p-6 bg-black/40 rounded-xl border border-gold/30 backdrop-blur-md shadow-[0_0_30px_rgba(255,215,0,0.1)] hover:scale-105 transition-transform duration-500 cursor-default">
                    <p class="text-gold text-sm uppercase tracking-[0.2em] mb-2 font-bold flex items-center justify-center gap-2"><span class="material-symbols-outlined text-sm animate-pulse">history_edu</span> Era da Guerra</p>
                    <div class="flex items-baseline justify-center gap-3"><span class="font-heading font-black text-4xl text-stone-500 mr-2">DIA</span><span id="server-days" class="font-heading font-black text-7xl text-white drop-shadow-[0_0_20px_rgba(255,215,0,0.6)]">0</span></div>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest mt-2">Desde 15 Dez 2025</p>
                </div>
                <div class="flex items-center gap-3 bg-obsidian/80 border border-stone-700 px-6 py-2 rounded-full hover:border-gold/50 transition-all cursor-default"><span class="material-symbols-outlined text-gold text-sm">groups</span><span class="text-xs font-bold uppercase tracking-widest text-gray-400">Guerreiros Convocados:</span><span id="participant-count" class="text-lg font-heading font-bold text-white">0</span></div>
            </div>

            <div class="block"><a href="#introducao" class="group relative inline-flex items-center gap-2 px-6 py-3 bg-transparent border border-stone-600 text-gray-400 font-bold uppercase tracking-widest text-xs hover:bg-white/5 hover:text-white hover:border-white transition-all duration-300">Ler os Decretos<span class="material-symbols-outlined group-hover:translate-x-1 transition-transform text-sm">arrow_downward</span></a></div>
        </div>
    </header>

    <section id="pantheom" class="py-24 bg-stone-900 border-b border-stone-800 fade-in-section relative">
         <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')] opacity-20"></div>
         <div class="max-w-7xl mx-auto px-4 relative z-10">
             <div class="text-center mb-16"><span class="material-symbols-outlined text-6xl text-gold mb-4 drop-shadow-[0_0_15px_rgba(255,215,0,0.8)]">crown</span><h2 class="text-4xl font-heading text-white mb-4">Pantheom dos L√≠deres</h2><div class="h-1 w-32 bg-gold mx-auto box-shadow-[0_0_10px_gold]"></div><p class="mt-4 text-gray-400">Os Quatro Pilares que sustentar√£o o destino da Titanomaquia.</p></div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="pantheom-card bg-obsidian border-2 border-red-600 rounded-lg overflow-hidden relative shadow-[0_0_25px_rgba(220,38,38,0.2)] hover:shadow-[0_0_40px_rgba(220,38,38,0.5)]"><div class="absolute top-0 right-0 p-2 z-20"><span class="bg-red-700 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Cl√£ Vermelho</span></div><div class="h-64 bg-gradient-to-b from-red-900/20 to-obsidian relative leader-img-container flex items-center justify-center"><img src="img/trojan.png" alt="Omega" class="h-full object-contain relative z-10 drop-shadow-[0_0_10px_rgba(0,0,0,0.8)]"><div class="absolute inset-0 border-b border-gold/30"></div></div><div class="p-6 text-center relative z-10"><h3 class="text-2xl font-heading text-white font-bold mb-1">Omega</h3><div class="h-px w-12 bg-red-600 mx-auto mb-4"></div><p class="text-sm text-gray-300 italic font-body">"Cora√ß√µes de Ferro, Alma de A√ßo"</p><div class="mt-4 pt-4 border-t border-red-900/30"><span class="material-symbols-outlined text-red-500">swords</span></div></div></div>
                <div class="pantheom-card bg-obsidian border-2 border-stone-600 rounded-lg overflow-hidden relative shadow-[0_0_25px_rgba(100,100,100,0.2)] hover:shadow-[0_0_40px_rgba(255,255,255,0.3)]"><div class="absolute top-0 right-0 p-2 z-20"><span class="bg-stone-700 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider border border-white/20">Cl√£ Preto</span></div><div class="h-64 bg-gradient-to-b from-stone-800/20 to-obsidian relative leader-img-container flex items-center justify-center"><img src="img/tiolk.png" alt="LK" class="h-full object-contain relative z-10 drop-shadow-[0_0_10px_rgba(0,0,0,0.8)]"><div class="absolute inset-0 border-b border-gold/30"></div></div><div class="p-6 text-center relative z-10"><h3 class="text-2xl font-heading text-white font-bold mb-1">LK</h3><div class="h-px w-12 bg-stone-500 mx-auto mb-4"></div><p class="text-sm text-gray-300 italic font-body">"O ouro e eu somos um s√≥"</p><div class="mt-4 pt-4 border-t border-stone-800/50"><span class="material-symbols-outlined text-stone-400">payments</span></div></div></div>
                <div class="pantheom-card bg-obsidian border-2 border-pink-500 rounded-lg overflow-hidden relative shadow-[0_0_25px_rgba(236,72,153,0.2)] hover:shadow-[0_0_40px_rgba(236,72,153,0.5)]"><div class="absolute top-0 right-0 p-2 z-20"><span class="bg-pink-600 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Cl√£ Rosa</span></div><div class="h-64 bg-gradient-to-b from-pink-900/20 to-obsidian relative leader-img-container flex items-center justify-center"><img src="img/soupyer.png" alt="Soupyer" class="h-full object-contain relative z-10 drop-shadow-[0_0_10px_rgba(0,0,0,0.8)]"><div class="absolute inset-0 border-b border-gold/30"></div></div><div class="p-6 text-center relative z-10"><h3 class="text-2xl font-heading text-white font-bold mb-1">Soupyer</h3><div class="h-px w-12 bg-pink-500 mx-auto mb-4"></div><p class="text-sm text-gray-300 italic font-body">"A vida √© uma d√°diva que eu preservarei"</p><div class="mt-4 pt-4 border-t border-pink-900/30"><span class="material-symbols-outlined text-pink-400">favorite</span></div></div></div>
                <div class="pantheom-card bg-obsidian border-2 border-blue-600 rounded-lg overflow-hidden relative shadow-[0_0_25px_rgba(37,99,235,0.2)] hover:shadow-[0_0_40px_rgba(37,99,235,0.5)]"><div class="absolute top-0 right-0 p-2 z-20"><span class="bg-blue-700 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Cl√£ Azul</span></div><div class="h-64 bg-gradient-to-b from-blue-900/20 to-obsidian relative leader-img-container flex items-center justify-center"><img src="img/mattkk.png" alt="Mattkk" class="h-full object-contain relative z-10 drop-shadow-[0_0_10px_rgba(0,0,0,0.8)]"><div class="absolute inset-0 border-b border-gold/30"></div></div><div class="p-6 text-center relative z-10"><h3 class="text-2xl font-heading text-white font-bold mb-1">Mattkk</h3><div class="h-px w-12 bg-blue-600 mx-auto mb-4"></div><p class="text-sm text-gray-300 italic font-body">"O ferro ainda que frio, queima"</p><div class="mt-4 pt-4 border-t border-blue-900/30"><span class="material-symbols-outlined text-blue-500">shield</span></div></div></div>
            </div>
         </div>
    </section>

    <section id="introducao" class="py-24 bg-obsidian border-b border-stone-800 relative"><div class="max-w-5xl mx-auto px-4 text-center"><span class="material-symbols-outlined text-6xl text-gold mb-4">auto_stories</span><h2 class="text-4xl font-heading text-white mb-4">A Cr√¥nica do Mundo</h2><p class="text-gray-300">Este n√£o √© apenas um servidor de sobreviv√™ncia; √© um Roleplay vivo.</p></div></section>
    
    <section id="ciclo" class="py-24 bg-stone-900 border-b border-stone-800"><div class="max-w-5xl mx-auto px-4 text-center"><h2 class="text-5xl font-heading text-white mb-10 gold-glow-text">I. O Ciclo do Sol</h2><p class="text-gray-300">Semana: 18h-00h | Fim de Semana: 14h-00h</p></div></section>

    <section id="clas" class="py-20 px-4 relative bg-Greek-pattern"><div class="max-w-6xl mx-auto text-center"><h2 class="text-4xl font-heading text-white mb-4">II. A Estrutura dos Cl√£s</h2><p class="text-gray-400">4 Cl√£s. 4 Cristais. 1 Destino.</p></div></section>

    <section id="economia" class="py-20 bg-stone-900"><div class="max-w-7xl mx-auto px-4 text-center"><h2 class="text-4xl font-heading text-white">IV. A Lei da Escassez</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8" id="economy-grid"></div></div></section>

    <section id="registro" class="py-20 bg-stone-900 border-b border-stone-800 relative fade-in-section">
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-16"><span class="material-symbols-outlined text-6xl text-gold mb-4">edit_document</span><h2 class="text-4xl font-heading text-white mb-4">Registro de Guerra</h2></div>
            
            <div id="registration-locked-msg" class="text-center py-12 border-2 border-stone-700 bg-black/50 rounded-lg hidden"><h3 class="text-2xl font-heading text-stone-400">Bloqueado</h3></div>

            <div id="registration-form-container" class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="bg-obsidian border-2 border-gold/50 p-8 rounded-lg relative">
                    <h3 class="text-2xl font-heading text-gold mb-6">Novo Registro</h3>
                    <form id="clan-form" class="space-y-6" onsubmit="event.preventDefault(); registerClan();">
                        <div><label class="block text-gray-400 text-sm font-bold mb-2">Estandarte:</label><div class="relative border border-stone-600 rounded bg-black/40 p-4 text-center"><input type="file" id="clan-banner-file" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="previewBanner(event)"><div id="banner-preview-area"><span class="material-symbols-outlined text-3xl text-stone-500">image</span></div><img id="banner-preview-img" class="hidden w-full h-32 object-cover rounded mt-2"></div></div>
                        <div><label class="block text-gray-400 text-sm font-bold mb-2">Nome:</label><input type="text" id="clan-name" class="input-mythic" required></div>
                        <div><label class="block text-gray-400 text-sm font-bold mb-2">Lema:</label><input type="text" id="clan-motto" class="input-mythic"></div>
                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2">Tema:</label>
                            <select id="clan-theme" class="input-mythic cursor-pointer" onchange="updateThemeInfo()"><option value="" disabled selected>Carregando...</option></select>
                            <div id="theme-info" class="mt-2 p-3 bg-black/40 rounded border border-stone-700 text-sm hidden"><p id="theme-desc" class="text-gray-300 italic mb-2"></p><div class="grid grid-cols-3 gap-2 text-xs text-center"><div class="bg-stone-800 p-1"><span class="text-gold block">L√≠der</span><span id="theme-leader-title" class="font-bold text-white"></span></div><div class="bg-stone-800 p-1"><span class="text-gray-400 block">Co-L√≠der</span><span id="theme-coleader-title" class="font-bold text-white"></span></div><div class="bg-stone-800 p-1"><span class="text-gray-500 block">Membros</span><span id="theme-member-title" class="font-bold text-white"></span></div></div></div>
                        </div>
                        <div><label class="block text-gray-400 text-sm font-bold mb-2">Cor:</label><input type="hidden" id="clan-color" value="#FFFFFF"><div class="glass-picker-grid" id="glass-picker"></div><p id="selected-color-name" class="text-xs text-gray-500 mt-2">Branco</p></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block text-gray-400 text-sm font-bold mb-2">L√≠der:</label><input type="text" id="clan-leader" class="input-mythic" required></div>
                            <div><label class="block text-gray-400 text-sm font-bold mb-2">Co-L√≠der:</label><input type="text" id="clan-coleader" class="input-mythic"></div>
                        </div>
                        <div><label class="block text-gray-400 text-sm font-bold mb-2">Membros:</label><textarea id="clan-members" class="input-mythic h-24 resize-none" required></textarea></div>
                        <div><label class="block text-gold text-sm font-bold mb-2">Economia:</label><input type="text" id="clan-economy-input" class="input-mythic bg-stone-800 text-gold" readonly required><input type="hidden" id="clan-economy-type"></div>
                        <button type="submit" id="register-btn" class="w-full py-4 bg-gold text-black font-heading font-bold text-xl hover:brightness-110">Registrar</button>
                    </form>
                    <div id="limit-reached-msg" class="absolute inset-0 bg-obsidian/90 flex items-center justify-center hidden"><h3>Limite Atingido</h3></div>
                </div>
                <div class="bg-bedrock/50 border border-stone-700 p-8 rounded-lg relative min-h-[500px]">
                    <h3 class="text-2xl font-heading text-white mb-6">Cl√£s Registrados <span id="clan-count" class="text-sm text-gray-400">(0/4)</span></h3>
                    <div id="clan-list" class="space-y-6 overflow-y-auto max-h-[600px]"><div class="text-center text-gray-500 mt-20 italic" id="empty-state">Nenhum cl√£ registrado.</div></div>
                    <div class="mt-4 pt-4 border-t border-white/5 text-center"><button onclick="deleteClanPrompt()" class="text-xs text-red-500">Admin Delete</button></div>
                </div>
            </div>
        </div>
    </section>

    <section id="saga" class="py-20 bg-bedrock"><div class="max-w-5xl mx-auto text-center"><h2 class="text-4xl font-heading text-white">V. A Saga</h2><p class="text-gray-400">Titans e Batalhas.</p></div></section>
    <section id="leis" class="py-20 bg-stone-900"><div class="max-w-4xl mx-auto text-center"><h2 class="text-4xl font-heading text-white">VI. Leis</h2></div></section>
    <section id="tesouro" class="py-20 bg-bedrock"><div class="max-w-6xl mx-auto text-center"><h2 class="text-5xl font-heading text-gold">VII. Tesouro</h2><p class="text-4xl font-black text-white mt-8">R$ 200,00</p></div></section>
    <footer class="bg-black py-16 text-center text-white"><p>Assinado: Tebas</p></footer>

    <audio id="bg-music" loop><source src="tema.mp3" type="audio/mpeg"></audio>
    <div id="music-controls" class="fixed bottom-6 left-6 z-50"><button onclick="toggleMusic()" class="w-12 h-12 bg-black/80 border-2 border-gold rounded-full text-gold flex items-center justify-center"><span id="music-icon" class="material-symbols-outlined">music_off</span></button></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // 1. DADOS LOCAIS (RODAM SEMPRE)
        const clanThemes = {
            "LEGADO": { symbol: "Œ©", desc: "\"Nascidos no fogo...\"", leader: "ARCONTE", coleader: "EXECUTOR", member: "ESPARTANOS" },
            "ONISCI√äNCIA": { symbol: "‚ò•", desc: "\"Os olhos que veem...\"", leader: "OR√ÅCULO", coleader: "ARAUTO", member: "ASCENDENTES" },
            "IMP√âRIO": { symbol: "‚ôõ", desc: "\"A ordem imposta...\"", leader: "IMPERADOR", coleader: "LEGATUS", member: "PRETORIANOS" },
            "MILITAR": { symbol: "‚öî", desc: "\"A tempestade...\"", leader: "SOBERANO", coleader: "MARECHAL", member: "VANGUARDA" },
            "MAJESTADE": { symbol: "‚öì", desc: "\"O sol nunca se p√µe...\"", leader: "IMPERADOR", coleader: "ALMIRANTE", member: "CAVALEIROS" },
            "OCULTO": { symbol: "‚òæ", desc: "\"O poder verdadeiro...\"", leader: "PRIMORDIAL", coleader: "PROFETA", member: "AC√ìLITOS" },
            "DOUTRINA": { symbol: "‚Ä†", desc: "\"Uma f√©...\"", leader: "MESTRE", coleader: "AP√ìSTOLO", member: "DISC√çPULOS" },
            "JUSTI√áA": { symbol: "‚öñ", desc: "\"A lei √© a √¢ncora...\"", leader: "TETRARCA", coleader: "JUSTI√áAR", member: "PATRICIANOS" },
            "NOBREZA": { symbol: "‚öú", desc: "\"O sangue azul...\"", leader: "DUQUE", coleader: "CHANCELER", member: "MARQU√äSES" },
            "HONRA": { symbol: "‚ùÄ", desc: "\"A morte √© leve...\"", leader: "SHOGUN", coleader: "TAISHO", member: "KENSEI" },
            "SOBERANIA": { symbol: "‚ôö", desc: "\"Nossa terra...\"", leader: "MONARCA", coleader: "LORDE", member: "BAR√ïES" },
            "PIRATA": { symbol: "‚ò†", desc: "\"Parte do navio...\"", leader: "LORDE PIRATA", coleader: "IMEDIATO", member: "SAQUEADORES" },
            "LAS NOCHES": { symbol: "üåí", desc: "\"N√£o h√° nada al√©m...\"", leader: "TRANSCENDENTAL", coleader: "GOVERNANTE", member: "ESPADAS" }
        };

        const glassColors = [
            {name: 'Branco', hex: '#FFFFFF'}, {name: 'Cinza Claro', hex: '#999999'}, {name: 'Cinza', hex: '#4c4c4c'}, {name: 'Preto', hex: '#191919'},
            {name: 'Marrom', hex: '#664c33'}, {name: 'Vermelho', hex: '#993333'}, {name: 'Laranja', hex: '#d87f33'}, {name: 'Amarelo', hex: '#e5e533'},
            {name: 'Verde Lima', hex: '#7fcc19'}, {name: 'Verde', hex: '#667f33'}, {name: 'Ciano', hex: '#4c7f99'}, {name: 'Azul Claro', hex: '#6699d8'},
            {name: 'Azul', hex: '#334cb2'}, {name: 'Roxo', hex: '#7f3fb2'}, {name: 'Magenta', hex: '#b24cd8'}, {name: 'Rosa', hex: '#f27fa5'}
        ];

        const state = { registeredClans: [], takenEconomies: new Set(), takenColors: new Set(), participants: [] };

        // 2. FUN√á√ïES DE INTERFACE (Seguras)
        function initInterface() {
            const themeSelect = document.getElementById('clan-theme');
            if(themeSelect) {
                themeSelect.innerHTML = '<option value="" disabled selected>Escolha sua Hierarquia...</option>';
                Object.keys(clanThemes).forEach(key => {
                    const opt = document.createElement('option');
                    opt.value = key; opt.text = `${clanThemes[key].symbol} ${key}`;
                    themeSelect.appendChild(opt);
                });
            }
            renderGlassPicker();
            renderEconomyGrid();
            updateServerUptime();
        }

        function updateThemeInfo() {
            const key = document.getElementById('clan-theme').value;
            const infoBox = document.getElementById('theme-info');
            if (!key || !clanThemes[key]) { infoBox.classList.add('hidden'); return; }
            const t = clanThemes[key];
            document.getElementById('theme-desc').innerText = t.desc;
            document.getElementById('theme-leader-title').innerText = t.leader;
            document.getElementById('theme-coleader-title').innerText = t.coleader;
            document.getElementById('theme-member-title').innerText = t.member;
            infoBox.classList.remove('hidden');
        }

        function updateServerUptime() {
             const start = new Date('2025-12-15T18:00:00');
             const diff = new Date() - start;
             let days = Math.floor(diff / (1000 * 60 * 60 * 24));
             if (days < 0) days = 0;
             const el = document.getElementById('server-days');
             if(el) el.innerText = days;
        }

        function renderGlassPicker() {
            const p = document.getElementById('glass-picker');
            if(p) p.innerHTML = glassColors.map(gc => `<div class="glass-option" style="background-color:${gc.hex}" onclick="selectColor('${gc.hex}','${gc.name}',this)"></div>`).join('');
        }
        function selectColor(hex, name, el) {
            document.querySelectorAll('.glass-option').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('clan-color').value = hex;
            document.getElementById('selected-color-name').innerText = name;
        }

        function renderEconomyGrid() {
             const g = document.getElementById('economy-grid');
             if(g) g.innerHTML = [
                 {id:'iron', name:'Caminho do A√ßo', icon:'shield', type:'Ferro'},
                 {id:'gold', name:'Caminho da Riqueza', icon:'payments', type:'Ouro'},
                 {id:'raid', name:'Caminho da Vida', icon:'local_fire_department', type:'Raid'},
                 {id:'xp', name:'Caminho do Encanto', icon:'bolt', type:'XP'}
             ].map(o => `<div id="opt-${o.id}" class="bg-obsidian border border-stone-600 p-6 rounded-lg cursor-pointer hover:border-gold" onclick="selectFarm('${o.name}','${o.type}', this)"><span class="material-symbols-outlined text-4xl mb-2 text-white">${o.icon}</span><h4 class="text-white">${o.name}</h4></div>`).join('');
        }
        function selectFarm(name, type, el) {
            if(el.classList.contains('farm-taken')) return;
            document.getElementById('clan-economy-input').value = name;
            document.getElementById('clan-economy-type').value = type;
        }

        // 3. CONEX√ÉO SUPABASE
        const supabaseUrl = 'https://tvaujvgnwpmuybnysmib.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2YXVqdmdud3BtdXlibnlzbWliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NjUwNDAsImV4cCI6MjA4MDA0MTA0MH0.d01sDTQ7LDHfzGgMq9CzrzUkg9pIv0Wa49PK_3geHhk';
        let supabase;

        async function initDatabase() {
            if (typeof window.supabase !== 'undefined') {
                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                await Promise.all([fetchParticipants(), fetchClans()]);
            }
        }

        async function fetchParticipants() {
            if(!supabase) return;
            const { data } = await supabase.from('participants').select('nickname');
            if(data) {
                state.participants = data.map(p => p.nickname);
                document.getElementById('participant-count').innerText = state.participants.length;
                startFloatingNames();
            }
        }

        async function fetchClans() {
            if(!supabase) return;
            const { data } = await supabase.from('clans').select('*').order('created_at', {ascending: true});
            const list = document.getElementById('clan-list');
            if(list) list.innerHTML = '';
            state.registeredClans = [];
            
            if(data && data.length > 0) {
                data.forEach(c => {
                    state.registeredClans.push(c);
                    // Update UI with clan info (simplificado para garantir funcionamento)
                    const div = document.createElement('div');
                    div.className = "bg-obsidian border p-4 rounded mb-2";
                    div.style.borderColor = c.color || '#444';
                    div.innerHTML = `<h4 class="text-white font-bold">${c.name}</h4><p class="text-gray-400 text-xs">${c.leader}</p>`;
                    list.appendChild(div);
                    
                    // Marcar economia como tomada
                    if(c.economy_type) {
                        const ids = {'Ferro':'opt-iron', 'Ouro':'opt-gold', 'Raid':'opt-raid', 'XP':'opt-xp'};
                        const el = document.getElementById(ids[c.economy_type]);
                        if(el) { el.classList.add('farm-taken', 'opacity-50', 'cursor-not-allowed'); }
                    }
                });
                document.getElementById('clan-count').innerText = `(${data.length}/4)`;
                if(data.length >= 4) document.getElementById('limit-reached-msg').classList.remove('hidden');
            } else {
                if(list) list.innerHTML = '<div class="text-center text-gray-500 italic">Nenhum cl√£ registrado.</div>';
            }
        }

        async function registerClan() {
            if(!supabase) return alert("Erro de conex√£o.");
            const btn = document.getElementById('register-btn');
            btn.innerText = "Enviando..."; btn.disabled = true;
            
            const fileInput = document.getElementById('clan-banner-file');
            let bannerUrl = null;
            
            try {
                if(fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const fileName = `banner_${Date.now()}.${file.name.split('.').pop()}`;
                    const { error: uploadError } = await supabase.storage.from('clan-banners').upload(fileName, file);
                    if(uploadError) throw uploadError;
                    const { data } = supabase.storage.from('clan-banners').getPublicUrl(fileName);
                    bannerUrl = data.publicUrl;
                }

                const { error } = await supabase.from('clans').insert([{
                    name: document.getElementById('clan-name').value,
                    motto: document.getElementById('clan-motto').value,
                    color: document.getElementById('clan-color').value,
                    theme: document.getElementById('clan-theme').value,
                    leader: document.getElementById('clan-leader').value,
                    coleader: document.getElementById('clan-coleader').value,
                    members: document.getElementById('clan-members').value,
                    economy: document.getElementById('clan-economy-input').value,
                    economy_type: document.getElementById('clan-economy-type').value,
                    banner_url: bannerUrl
                }]);

                if(error) throw error;
                alert("Registrado com sucesso!");
                fetchClans();
                document.getElementById('clan-form').reset();
            } catch(e) {
                alert("Erro: " + e.message);
            }
            btn.innerText = "Registrar"; btn.disabled = false;
        }

        function startFloatingNames() { /* L√≥gica de nomes flutuantes aqui */ }
        function previewBanner(e) { 
            const url = URL.createObjectURL(e.target.files[0]);
            document.getElementById('banner-preview-img').src = url;
            document.getElementById('banner-preview-img').classList.remove('hidden');
            document.getElementById('banner-preview-area').classList.add('hidden');
        }
        function openJoinModal() { document.getElementById('join-modal').classList.remove('hidden'); }
        function closeJoinModal() { document.getElementById('join-modal').classList.add('hidden'); }
        function deleteClanPrompt() { if(prompt("Senha") === "TEBAS") { /* Delete logic */ } }

        // M√öSICA
        const audio = document.getElementById('bg-music');
        const mIcon = document.getElementById('music-icon');
        let playing = false;
        function toggleMusic() {
            if(playing) { audio.pause(); mIcon.innerText='music_off'; playing=false; }
            else { audio.play().then(()=>{mIcon.innerText='music_note'; playing=true;}).catch(e=>console.log(e)); }
        }
        document.body.addEventListener('click', ()=>{if(!playing)toggleMusic();}, {once:true});

        // INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', () => {
            initInterface();
            initDatabase();
        });
    </script>
</body>
</html>
